#!/usr/bin/env bash

if [ "$UID" -ne 0 ]
then
    >&2 echo "This script requires superuser priviledges."
    exit 1
fi

# Target version
TAG="2019-04-07"

# Make sure the folder exists
INSTALL_DIR="/opt/pentatonic-scales"
mkdir -p "$INSTALL_DIR"

# Check if the target version is already installed (test for symlink created by this script)
if [ -e "$INSTALL_DIR/$TAG.html" ]; then
    echo "pentatonic-scales $TAG already installed"
else
    # Remove previous versions
    rm -rf "$INSTALL_DIR"/{*,.*} 2> /dev/null

    # Download and unpack the ZIP file
    TEMP_ZIP="$(mktemp)"
    TEMP_DIR="$(mktemp -d)"
    wget -O "$TEMP_ZIP" "https://www.dropbox.com/sh/54esslpdwop9r40/AAB-JY50lzqg6iBNy8j68o-pa?dl=1"
    unzip "$TEMP_ZIP" PentatonicScales.zip -d "$TEMP_DIR"
    unzip "$TEMP_DIR/PentatonicScales.zip" -d "$TEMP_DIR"
    mv "$TEMP_DIR/PentatonicScales/"* "$INSTALL_DIR/"
    rm -f "$TEMP_ZIP"
    rm -rf "$TEMP_DIR"
    
    # Create a symlink to the exe file to serve as identifier for the installed version
    ln -s "$INSTALL_DIR/index.html" "$INSTALL_DIR/$TAG.html"
fi
