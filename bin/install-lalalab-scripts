#!/usr/bin/env bash

if [ "$UID" -ne 0 ]
then
    >&2 echo "This script requires superuser priviledges."
    exit 1
fi

# retrieve files via git
DIR="/opt/lalalab-scripts"
mkdir -p "$DIR"
cd "$DIR"
git init
git remote remove origin &> /dev/null || true
git remote add origin https://github.com/IMAGINARY/lalalab-scripts.git
git fetch --tags origin
git reset --hard origin/feature/install-scripts
git checkout feature/install-scripts

# sync the rootfs
rsync -va --info=ALL --exclude ".gitkeep" "$DIR/rootfs/" /

# permanently set the hostname
HOSTNAME=$(./bin/get-hostname-by-mac)
echo "$HOSTNAME" > /etc/hostname
hostname "$HOSTNAME"

# modify configuration files on the host
./bin/internal/modify-os-cfg
